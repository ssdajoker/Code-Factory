# Code-Factory User Guide

Welcome to Code-Factory! This guide will help you get started with the 
Spec-Driven Software Factory system.

---

## Table of Contents

1. [Installation](#installation)
2. [Quick Start](#quick-start)
3. [Core Concepts](#core-concepts)
4. [Modes](#modes)
5. [Configuration](#configuration)
6. [Tips & Tricks](#tips--tricks)
7. [Troubleshooting](#troubleshooting)
8. [FAQ](#faq)

---

## Installation

### One-Line Install (Recommended)

```bash
curl -sSL https://raw.githubusercontent.com/ssdajoker/Code-Factory/main/scripts/install.sh | sh
```

### Alternative Methods

**Homebrew (macOS/Linux):**
```bash
brew tap ssdajoker/factory
brew install factory
```

**Winget (Windows):**
```bash
winget install ssdajoker.factory
```

**Docker:**
```bash
docker pull ghcr.io/ssdajoker/factory:latest
docker run -it -v $(pwd):/workspace ghcr.io/ssdajoker/factory init
```

---

## Quick Start

### 1. Initialize Factory

```bash
factory init
```

This will:
- Authenticate with GitHub
- Install GitHub App
- Configure LLM provider
- Set up project structure

### 2. Start the TUI

```bash
factory
```

### 3. Create Your First Spec

Press `i` to enter INTAKE mode, then describe your feature:

```
I want to build a user authentication system with email/password login,
OAuth (Google, GitHub), JWT tokens, and password reset flow.
```

Press `Ctrl+Enter` to generate the specification.

### 4. Review Code Against Spec

Press `r` to enter REVIEW mode, select your spec, and let Factory analyze 
your code for compliance.

---

## Core Concepts

### Specifications (Contracts)

Specifications are markdown documents stored in `/contracts/` that describe 
what your software should do. They serve as the source of truth for your project.

**Example:**
```markdown
# User Authentication System

## Requirements
1. Email/password login
2. OAuth integration (Google, GitHub)
3. JWT token management
...
```

### Reports

Reports are generated by Factory to document code reviews, change orders, and 
other analyses. They're stored in `/reports/`.

### Modes

Factory operates in four distinct modes:

1. **INTAKE:** Capture vision and create specs
2. **REVIEW:** Check code against specs
3. **CHANGE_ORDER:** Track specification drift
4. **RESCUE:** Reverse-engineer existing code

---

## Modes

### INTAKE Mode

**Purpose:** Create new specifications

**How to Use:**
1. Start Factory: `factory intake`
2. Describe your feature in detail
3. Press `Ctrl+Enter` to generate spec
4. Review and edit the generated spec
5. Press `Ctrl+S` to save

**Tips:**
- Be as detailed as possible in your description
- Include requirements, constraints, and technologies
- Mention security and performance considerations

### REVIEW Mode

**Purpose:** Check code compliance with specs

**How to Use:**
1. Start Factory: `factory review`
2. Select a specification to review
3. Wait for analysis to complete
4. Review findings (compliant, warnings, issues)
5. Press `Enter` on an issue to see details
6. Press `R` to generate a report

**Tips:**
- Run reviews regularly (e.g., before merging PRs)
- Focus on critical issues first
- Use suggested fixes as starting points

### CHANGE_ORDER Mode

**Purpose:** Track and manage specification drift

**How to Use:**
1. Start Factory: `factory change-order`
2. Factory detects changes since last review
3. Review each change for spec compliance
4. Approve (update spec) or Reject (create issue)
5. Factory updates specs or creates GitHub issues

**Tips:**
- Run after significant code changes
- Approve intentional changes, reject accidental drift
- Keep specs up-to-date with approved changes

### RESCUE Mode

**Purpose:** Generate specs from existing code

**How to Use:**
1. Start Factory: `factory rescue`
2. Factory scans your codebase
3. AI generates specifications
4. Review and edit generated specs
5. Save to `/contracts/`

**Tips:**
- Use for legacy projects without documentation
- Review generated specs carefully
- Edit to add context AI might miss

---

## Configuration

### Global Configuration

Located at `~/.factory/config.toml`:

```toml
[user]
name = "Your Name"
email = "you@example.com"

[github]
token_storage = "keyring"  # or "file", "env"

[llm]
provider = "ollama"
model = "codellama:7b"
endpoint = "http://localhost:11434"

[ui]
theme = "auto"  # auto, light, dark
editor = "vim"
```

### Project Configuration

Located at `{project}/.factory/config.toml`:

```toml
[project]
name = "My Project"
repository = "owner/repo"

[contracts]
directory = "contracts"

[reports]
directory = "reports"
```

### Environment Variables

Override configuration with environment variables:

```bash
export FACTORY_GITHUB_TOKEN="gho_xxxxxxxxxxxxxxxxxxxx"
export FACTORY_LLM_PROVIDER="openai"
export FACTORY_LLM_MODEL="gpt-4-turbo-preview"
export FACTORY_LLM_API_KEY="sk-xxxxxxxxxxxxxxxxxxxx"
```

---

## Tips & Tricks

### Keyboard Shortcuts

**Global:**
- `q` - Quit
- `?` - Help
- `Ctrl+C` - Cancel

**INTAKE Mode:**
- `Ctrl+Enter` - Generate spec
- `Ctrl+S` - Save spec
- `Ctrl+E` - Edit spec

**REVIEW Mode:**
- `Enter` - View issue details
- `R` - Generate report
- `I` - Create GitHub issue

**CHANGE_ORDER Mode:**
- `A` - Approve change
- `R` - Reject change
- `S` - Skip change

### Best Practices

1. **Write Detailed Specs:** The more detail you provide, the better Factory 
   can help you maintain code quality.

2. **Review Regularly:** Run reviews before merging PRs to catch issues early.

3. **Keep Specs Updated:** Use CHANGE_ORDER mode to keep specs in sync with code.

4. **Use Templates:** Factory provides templates for common spec types.

5. **Collaborate:** Commit specs to git so your team can use them.

### Working with Teams

**Setup:**
1. First team member runs `factory init` and commits `.factory/config.toml`
2. Other team members clone repo and run `factory init --team`
3. Everyone has their own GitHub auth and LLM config
4. Specs are shared via git

---

## Troubleshooting

### GitHub Authentication Failed

**Problem:** Can't authenticate with GitHub

**Solutions:**
1. Check internet connection
2. Try device flow: `factory init --device-flow`
3. Reset auth: `factory auth reset`
4. Use environment variable: `export FACTORY_GITHUB_TOKEN="..."`

### LLM Not Detected

**Problem:** Factory can't find LLM provider

**Solutions:**
1. **For Ollama:** 
   - Check if running: `curl http://localhost:11434/api/tags`
   - Start Ollama: `ollama serve`
   - Pull a model: `ollama pull codellama`

2. **For Cloud LLMs:**
   - Configure API key: `factory config llm`
   - Or use environment variable: `export FACTORY_LLM_API_KEY="..."`

### Slow Performance

**Problem:** Factory is slow

**Solutions:**
1. Use local Ollama instead of cloud LLMs
2. Reduce number of files analyzed (use .gitignore)
3. Use smaller LLM models
4. Check internet connection (for cloud LLMs)

### Permission Denied

**Problem:** Can't write to `/contracts/` or `/reports/`

**Solutions:**
1. Check file permissions: `ls -la contracts/`
2. Ensure you're in the right directory
3. Check git status: `git status`

---

## FAQ

**Q: Do I need GitHub to use Factory?**  
A: No, Factory works offline without GitHub. You'll miss GitHub integration 
features (issue creation, PR comments), but core functionality works.

**Q: Do I need an LLM to use Factory?**  
A: No, Factory can work without an LLM using templates and manual editing. 
However, LLM features (spec generation, code analysis) won't be available.

**Q: Is my code sent to the cloud?**  
A: Only if you use cloud LLM providers (OpenAI, Claude, etc.). If you use 
Ollama, everything stays local.

**Q: Can I use Factory with private repositories?**  
A: Yes, Factory supports private repositories. You'll need to grant the 
GitHub App access to your private repos.

**Q: How do I update Factory?**  
A: Run `factory update` (future feature) or re-run the install script.

**Q: Can I customize the spec templates?**  
A: Yes, create custom templates in `~/.factory/templates/`.

**Q: Does Factory support languages other than Go?**  
A: Yes, Factory is language-agnostic. It works with any codebase.

**Q: Can I use Factory in CI/CD?**  
A: Yes, Factory can run in headless mode for CI/CD integration (future feature).

---

## Getting Help

- **Documentation:** https://github.com/ssdajoker/Code-Factory/docs
- **Issues:** https://github.com/ssdajoker/Code-Factory/issues
- **Discussions:** https://github.com/ssdajoker/Code-Factory/discussions

---

**Happy Building! üè≠**
